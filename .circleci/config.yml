version: 2
jobs:
  test_app:
    macos:
      xcode: "10.2.0"
    working_directory: ~/MiniApp
    shell: /bin/bash --login -o pipefail
    steps:
      - checkout
      - restore_cache:
          key: 1-gems-{{ checksum "Gemfile.lock" }}
      - run: bundle check || bundle install --path vendor/bundle
      - save_cache:
          key: 1-gems-{{ checksum "Gemfile.lock" }}
          paths:
            - vendor/bundle
      - run:
          name: fastlane
          command: |
            cd MiniApp
            # fastlane do_test_app --env Dev
            fastlane do_build_app --env Dev
            # fastlane do_upload_app_to_testflight --env Dev
            # fastlane alpha --env Dev

workflows:
  version: 2
  test_develop:
    jobs:
      - test_app:
          filters:
            branches:
              only: develop
